<!DOCTYPE html>
<html>
    <head>
        <title>College Football | Game on Paper</title>    
    </head>
    <body>
        <div class="container-fluid">
            <div class="row text-center mb-3">
                <div class="form-signin col-12">
                    <form id="game-id-form">
                    <h1 class="h3 mb-3 fw-normal">Game on Paper</h1>
                    <label for="inputGameId" class="visually-hidden">Game ID</label>
                    <input type="text" id="inputGameId" class="form-control mb-3" placeholder="Provide a valid ESPN Game ID for a CFB game" required="">
                    <button class="w-100 btn btn-lg btn-primary" type="submit">View Data</button>
                    </form>
                </div>
            </div>
            <div class="row mb-3">
                <div class="col-12">
                    <h2>College Football</h2>
                    <% if (scoreboard.length > 0) {%>
                        <table class="table table-striped table-md">
                            <thead>
                                <tr>
                                    <th style="text-align: left;">Status</th>
                                    <th style="text-align: center;">Away</th>
                                    <th style="text-align: center;">Home</th>
                                    <th style="text-align: left;">Last Play</th>
                                    <th style="text-align: right;"></th>
                                </tr>
                            </thead>
                            <tbody>
                                <% 
                                function generateTeamImg(teamId) {
                                    return `<img class="img-fluid" width="35px" src="https://a.espncdn.com/i/teamlogos/ncaa/500/${teamId}.png" alt="ESPN team id ${teamId}"/>`;
                                }

                                function formatScore(score, winner) {
                                    if (winner) {
                                        return `<b>${score}</b>`
                                    } else {
                                        return `${score}`
                                    }
                                }
                                
                                scoreboard.forEach(game => { %>
                                    <tr>
                                        <% 
                                            const gameComp = game.competitions[0];
                                            const homeComp = gameComp.competitors[0];
                                            const awayComp = gameComp.competitors[1];
                                            const homeTeam = homeComp.team;
                                            const awayTeam = awayComp.team;
                                        %>
                                        <td style="text-align: left;">
                                            <% if (game.status.type.name.includes("STATUS_SCHEDULED")) { %>
                                            <span class="game-date"><%= game.date %></span>
                                            <% } else if (game.status.type.completed == true) { %>
                                            <span><%= game.status.type.detail %> -</span> <span class="game-date"><%= game.date %></span>  
                                            <% } else { %>
                                            <%= game.status.type.detail %>
                                            <% } %>
                                        </td>
                                        <td style="text-align: center;"><%- generateTeamImg(awayComp.id) %> 
                                            <span class="inline-block"><%- (game.status.type.name.includes("STATUS_SCHEDULED") || game.status.type.detail.includes("Cancel") || game.status.type.detail.includes("Postpone")) ? "" : formatScore(awayComp.score, (parseInt(awayComp.score) > parseInt(homeComp.score) && game.status.type.completed == true)) %></span>
                                        </td>
                                        <td style="text-align: center;"><%- generateTeamImg(homeComp.id) %> 
                                            <span class="inline-block"><%- (game.status.type.name.includes("STATUS_SCHEDULED") || game.status.type.detail.includes("Cancel") || game.status.type.detail.includes("Postpone")) ? "" : formatScore(homeComp.score, (parseInt(homeComp.score) > parseInt(awayComp.score) && game.status.type.completed == true)) %></span>
                                        </td>
                                        <td style="text-align: left;">
                                            <% if (!(game.status.type.completed == true || game.status.type.detail.includes("Cancel") || game.status.type.detail.includes("Postpone"))) { %>
                                                <% if (gameComp.situation != null && gameComp.situation.lastPlay != null) { %>
                                                    <% if (gameComp.situation.lastPlay.text.toLocaleLowerCase().includes("two-point conversion") || gameComp.situation.lastPlay.text.includes("KICK")) { %>
                                                        <span class="inline-block">(PAT) <%= gameComp.situation.lastPlay.text %></span>
                                                    <% } else if (gameComp.situation.lastPlay.text.toLocaleLowerCase().includes("kickoff")) { %>
                                                        <span class="inline-block">(Kickoff) <%= gameComp.situation.lastPlay.text %></span>
                                                    <% } else if (gameComp.situation.downDistanceText == null || (gameComp.situation.downDistanceText != null && gameComp.situation.downDistanceText.length == 0)) { %>
                                                        <span class="inline-block"><%= gameComp.situation.lastPlay.text %></span>
                                                    <% } else { %>
                                                        <span class="inline-block">(<%= gameComp.situation.downDistanceText %>) <%= gameComp.situation.lastPlay.text %></span>
                                                    <% } %>
                                                <% } %>
                                            <% } %>
                                        </td>
                                        <td style="text-align: right;"><span class="inline-block"><a href="/cfb/game/<%= game.id %>">Stats</a></span></td>
                                    </tr>
                                <% }); %>
                            </tbody>
                        </table>
                    <% } else { %>
                        <p class="text-center">No games scheduled today.</p>
                    <% } %>
                </div>
            </div>
            <div class="row text-center">
                <%- include('../partials/footer') %>
            </div>
        </div>
        <link href="/assets/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-giJF6kkoqNQ00vy+HMDP7azOuL0xtbfIcaT9wjKHr8RbDVddVHyTfAAsrekwKmP1" crossorigin="anonymous">
        <link href="/assets/css/index.css" rel="stylesheet">
        <%- include('../partials/scripts') %>
        <script>
            const DateTime = luxon.DateTime;
            function formatDateTime(inputDate) {
                return DateTime.fromISO(inputDate).toLocaleString(DateTime.DATETIME_FULL)
            }
            var gameDates = document.getElementsByClassName("game-date");
            if (gameDates.length > 0) {
                console.log(gameDates)
                for (var i = 0; i < gameDates.length; i++) {
                    var dateElem = gameDates[i];
                    // console.log(dateElem)
                    dateElem.innerText = formatDateTime(dateElem.innerText)
                }
            } else {
                console.log("no game dates found")
            }
    
    
        </script>
        <script>
            document.getElementById("game-id-form").addEventListener("submit", function(e) {
                e.preventDefault()
                var gameId = document.getElementById("inputGameId").value;
                window.location = "/cfb/game/" + gameId;
            });
        </script>
    </body>
</html>